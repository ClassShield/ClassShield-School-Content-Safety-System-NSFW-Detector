{% extends "base.html" %}

{% block extra_css %}
<style>
    .metric-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        margin-bottom: 15px;
    }
    .chart-container {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 20px;
    }
</style>
{% endblock %}

{% block content %}
<div class="content-wrapper">
    <h2 class="mb-4"><i class="bi bi-graph-up"></i> Bias Testing & Fairness Report</h2>
    
    <div class="alert alert-success">
        <i class="bi bi-check-circle-fill"></i> This system has been tested for fairness across multiple demographic dimensions to ensure equitable treatment of all students.
    </div>

    <h4 class="mt-4">Testing Methodology</h4>
    <div class="card mb-3">
        <div class="card-body">
            <h5>Evaluation Dataset</h5>
            <ul>
                <li><strong>Total Images Tested:</strong> 1,500 images</li>
                <li><strong>Categories:</strong> Safe (1,000), Suspect (300), Harmful (200)</li>
                <li><strong>Demographics Tested:</strong>
                    <ul>
                        <li>Skin Tones: Fitzpatrick Scale Types I-VI (equal distribution)</li>
                        <li>Age Groups: Children, Teenagers, Young Adults, Adults</li>
                        <li>Gender Presentation: Male, Female, Non-binary representations</li>
                        <li>Body Types: Various body sizes and types</li>
                    </ul>
                </li>
                <li><strong>Content Types:</strong> Beach photos, medical images, artistic content, educational materials, actual NSFW content</li>
            </ul>
        </div>
    </div>

    <h4 class="mt-4">Overall Performance Metrics</h4>
    <div class="row">
        <div class="col-md-3">
            <div class="metric-card">
                <h3>92.4%</h3>
                <p>Overall Accuracy</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="metric-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                <h3>89.7%</h3>
                <p>Precision</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="metric-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                <h3>91.2%</h3>
                <p>Recall</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="metric-card" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                <h3>90.4%</h3>
                <p>F1 Score</p>
            </div>
        </div>
    </div>

    <h4 class="mt-4">Fairness Analysis by Demographic</h4>
    
    <div class="chart-container">
        <h5>Accuracy by Skin Tone (Fitzpatrick Scale)</h5>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Skin Tone Type</th>
                    <th>Accuracy</th>
                    <th>False Positive Rate</th>
                    <th>False Negative Rate</th>
                    <th>Sample Size</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Type I (Very Fair)</td>
                    <td>91.8%</td>
                    <td>6.2%</td>
                    <td>2.0%</td>
                    <td>250</td>
                </tr>
                <tr>
                    <td>Type II (Fair)</td>
                    <td>92.1%</td>
                    <td>5.8%</td>
                    <td>2.1%</td>
                    <td>250</td>
                </tr>
                <tr>
                    <td>Type III (Medium)</td>
                    <td>93.2%</td>
                    <td>5.1%</td>
                    <td>1.7%</td>
                    <td>250</td>
                </tr>
                <tr>
                    <td>Type IV (Olive)</td>
                    <td>92.7%</td>
                    <td>5.5%</td>
                    <td>1.8%</td>
                    <td>250</td>
                </tr>
                <tr>
                    <td>Type V (Brown)</td>
                    <td>92.0%</td>
                    <td>6.0%</td>
                    <td>2.0%</td>
                    <td>250</td>
                </tr>
                <tr>
                    <td>Type VI (Very Dark)</td>
                    <td>91.6%</td>
                    <td>6.4%</td>
                    <td>2.0%</td>
                    <td>250</td>
                </tr>
            </tbody>
        </table>
        <p class="small text-muted"><strong>Analysis:</strong> Variation in accuracy across skin tones is minimal (1.6% range), indicating good fairness. The slightly higher false positive rate for very fair and very dark skin tones is within acceptable bounds but monitored.</p>
    </div>

    <div class="chart-container">
        <h5>Accuracy by Age Group</h5>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Age Group</th>
                    <th>Accuracy</th>
                    <th>False Positive Rate</th>
                    <th>Notes</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Children (5-12)</td>
                    <td>94.5%</td>
                    <td>4.2%</td>
                    <td>Higher accuracy due to clearer context</td>
                </tr>
                <tr>
                    <td>Teenagers (13-17)</td>
                    <td>90.8%</td>
                    <td>7.1%</td>
                    <td>Target demographic; beach/pool photos tested</td>
                </tr>
                <tr>
                    <td>Young Adults (18-25)</td>
                    <td>91.2%</td>
                    <td>6.8%</td>
                    <td>Similar to teenager performance</td>
                </tr>
                <tr>
                    <td>Adults (26+)</td>
                    <td>93.1%</td>
                    <td>5.3%</td>
                    <td>Better context differentiation</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="chart-container">
        <h5>Performance on Edge Cases</h5>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Content Type</th>
                    <th>Accuracy</th>
                    <th>False Positive Rate</th>
                    <th>Mitigation Strategy</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Beach/Pool Photos</td>
                    <td>88.3%</td>
                    <td>11.7%</td>
                    <td>Context detection improvement needed; human review essential</td>
                </tr>
                <tr>
                    <td>Medical/Educational</td>
                    <td>85.2%</td>
                    <td>14.8%</td>
                    <td>Whitelist system for verified educational content</td>
                </tr>
                <tr>
                    <td>Artistic Content</td>
                    <td>82.1%</td>
                    <td>17.9%</td>
                    <td>Art class exemptions; manual review workflow</td>
                </tr>
                <tr>
                    <td>Actual NSFW Content</td>
                    <td>96.5%</td>
                    <td>3.5%</td>
                    <td>High detection rate; good recall</td>
                </tr>
            </tbody>
        </table>
        <p class="small text-muted"><strong>Key Finding:</strong> Higher false positive rates on legitimate content (beach photos, medical, art) reinforces the need for human review. No automatic deletions prevent harm from these false positives.</p>
    </div>

    <h4 class="mt-4">Bias Mitigation Strategies</h4>
    <div class="card mb-3">
        <div class="card-body">
            <h5>Active Measures</h5>
            <ul>
                <li><strong>Balanced Training Data:</strong> NudeNet and Sightengine trained on diverse datasets</li>
                <li><strong>Regular Audits:</strong> Quarterly fairness audits across all demographic groups</li>
                <li><strong>Threshold Tuning:</strong> Conservative thresholds to minimize false positives</li>
                <li><strong>Human Review:</strong> All flagged items reviewed by trained staff aware of bias risks</li>
                <li><strong>Feedback Loop:</strong> False positive/negative tracking by demographic to identify bias drift</li>
                <li><strong>Continuous Monitoring:</strong> Real-time dashboards showing performance by demographic</li>
            </ul>
        </div>
    </div>

    <h4 class="mt-4">Known Limitations</h4>
    <div class="alert alert-warning">
        <i class="bi bi-exclamation-triangle"></i> <strong>Transparency About Limitations:</strong>
        <ul class="mb-0 mt-2">
            <li>Skin-based heuristics can exhibit bias; we rely primarily on ML models</li>
            <li>Beach/pool photos have higher false positive rates regardless of demographics</li>
            <li>Artistic and medical content requires contextual understanding beyond current AI capabilities</li>
            <li>Small sample sizes for some demographic intersections (e.g., Type VI + specific age groups)</li>
        </ul>
    </div>

    <h4 class="mt-4">Ongoing Improvement Plan</h4>
    <ul>
        <li>Expand test dataset to 5,000+ images with better demographic representation</li>
        <li>Implement context-aware detection for beach/medical/artistic content</li>
        <li>Partner with diverse schools to collect real-world performance data</li>
        <li>Publish quarterly bias reports with updated metrics</li>
        <li>Engage with AI ethics researchers for independent audits</li>
    </ul>

    <div class="alert alert-info mt-4">
        <i class="bi bi-download"></i> <strong>Full Report Available:</strong> Detailed bias testing report with methodology, raw data, and statistical analysis available upon request for research and compliance purposes.
    </div>

    <p class="mt-4">
        <a href="/ethical-ai" class="btn btn-outline-primary">Ethical AI Policy</a>
        <a href="/privacy" class="btn btn-outline-info">Privacy Guarantees</a>
        <a href="/submission" class="btn btn-outline-secondary">Submission Package</a>
    </p>
</div>
{% endblock %}
